<!--
 - Created by BRITENET on 08.02.2019.
 -->
        
<aura:component description="ECS_ComplaintsMain"
                implements="forceCommunity:availableForAllPageTypes,flexipage:availableForAllPageTypes" access="global"
                controller="ECS_CarsManagerController">

    <aura:attribute name="customerPurchasedItems" type="Object[]"/>
    <aura:attribute name="selectedCarsIds" type="String[]"/>
    <aura:attribute name="selectedCarId" type="String"/>
    <aura:attribute name="displayCaseModal" type="Boolean"/>
    <aura:attribute name="selectedCaseItemId" type="String"/>
    <aura:handler name="init" value="{! this }" action="{! c.init }"/>
    <aura:handler name="CaseAdded" event="c:ECS_CaseAdded" action="{!c.onCaseAdded}"/>

    <lightning:tabset variant="scoped">
        <lightning:tab label ="Add Case">
    <lightning:card title="Purchased Items" class="slds-tabs_card">
        <lightning:layout horizontalAlign="center" verticalAlign="center" multipleRows='true'>
            <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                <thead>
                <tr class="slds-text-title_caps">
                    <th scope="col">
                        <div class="slds-truncate" title="{!$Label.c.ECS_NO}">{!$Label.c.ECS_NO}</div>
                    </th>
                    <th scope="col">
                        <div class="slds-truncate" title="{!$Label.c.ECS_Brand}">{!$Label.c.ECS_Brand}</div>
                    </th>
                    <th scope="col">
                        <div class="slds-truncate" title="{!$Label.c.ECS_Model}">{!$Label.c.ECS_Model}</div>
                    </th>
                    <th scope="col">
                        <div class="slds-truncate" title="{!$Label.c.ECS_Year}">{!$Label.c.ECS_Year}</div>
                    </th>
                    <th scope="col">
                        <div class="slds-truncate" title="{!$Label.c.ECS_Order_Date}">{!$Label.c.ECS_Order_Date}</div>
                    </th>
                    <th scope="col">
                        <div class="slds-truncate" title="{!$Label.c.ECS_Actions}">{!$Label.c.ECS_Actions}</div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <aura:iteration items="{!v.customerPurchasedItems}" var="customerPurchasedItem" indexVar="index">
                    <tr aura:id="tableRow" data-index="{!index}">
                        <td data-label="{!$Label.c.ECS_NO}">
                            <lightning:formattedNumber value="{!index + 1}"/>
                        </td>
                        <td data-label="{!$Label.c.ECS_Brand}">
                            <lightning:formattedText value="{!customerPurchasedItem.Product2.ECS_Brand__c}"/>
                        </td>
                        <td data-label="{!$Label.c.ECS_Model}">
                            <lightning:formattedText value="{!customerPurchasedItem.Product2.ECS_Model__c}"/>
                        </td>
                        <td data-label="{!$Label.c.ECS_Year}">
                            <lightning:formattedText value="{!customerPurchasedItem.Product2.ECS_ProductionYear__c}"/>
                        </td>
                        <td data-label="{!$Label.c.ECS_Order_Date}">
                            <lightning:formattedDateTime day="2-digit" month="numeric" year="numeric"  hour="2-digit" minute="2-digit" value="{!customerPurchasedItem.Order.CreatedDate}"/>
                        </td>
                        <td data-label="{!$Label.c.ECS_Actions}">
                            <lightning:button name="{!$Label.c.ECS_Go_to_Product}"
                                              onclick="{!c.redirectToDetailsPage}" value="{!customerPurchasedItem.Product2.Id}">
                                <lightning:icon iconName="action:info" size="medium"/>
                                &nbsp;{!$Label.c.ECS_Go_to_Product}
                            </lightning:button>
                            <lightning:button name="{!$Label.c.ECS_Add_Case}" disabled="{!customerPurchasedItem.ECS_isCaseed__c}" onclick="{!c.displayCaseModal}" value="{!customerPurchasedItem}">
                                <lightning:icon iconName="action:new_case" size="medium"/>
                                &nbsp;{!$Label.c.ECS_Add_Case}
                            </lightning:button>
                        </td>
                    </tr>
                </aura:iteration>
                </tbody>
            </table>


            <aura:if isTrue="{!v.displayCaseModal}">

                <!--###### MODAL BOX Start######-->
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium" >
                    <div class="slds-modal__container">
                        <!-- ###### MODAL BOX HEADER Start ######-->
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close"
                                                  onclick="{! c.hideCaseModal }"
                                                  alternativeText="{!$Label.c.ECS_Close}"
                                                  variant="bare-inverse"
                                                  class="slds-modal__close"/>
                            <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{!$Label.c.ECS_Add_Case}</h2>
                        </header>
                        <!--###### MODAL BOX BODY Part Start######-->
                        <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">

                            <lightning:layoutItem size="" >
                                <lightning:card title="" iconName="" class="slds-m-horizontal--small" actions="">
                                    <c:ECS_AddCarCase carId="{!v.selectedCarId}"/>
                                </lightning:card>
                            </lightning:layoutItem>


                        </div>
                        <!--###### MODAL BOX FOOTER Part Start ######-->
                        <footer class="slds-modal__footer">
                            <lightning:button variant="neutral"
                                              label="{!$Label.c.ECS_Close}"
                                              title="{!$Label.c.ECS_Close}"
                                              onclick="{! c.hideCaseModal }"/>
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
                <!--###### MODAL BOX Part END Here ######-->

            </aura:if>


        </lightning:layout>

    </lightning:card>
        </lightning:tab>
        <lightning:tab label="Case In Progress">
        <c:ECS_ActiveCases/>
        </lightning:tab>
        <lightning:tab label="Case Closed">
        <c:ECS_SolvedCases/>
        </lightning:tab>
    </lightning:tabset>

</aura:component>