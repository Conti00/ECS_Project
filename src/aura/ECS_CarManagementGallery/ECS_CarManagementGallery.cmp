<!--
 - Created by BRITENET on 04.02.2019.
 -->

<aura:component description="ECS_CarManagementGallery"
                implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,
                force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction"
                controller="ECS_CarsManagerController">

    <aura:attribute name="carId" type="String"/>
    <aura:attribute name="carImages" type="String[]"/>
    <aura:attribute name="carTargetFields" type="Product2"/>
    <aura:attribute name="isAdmin" type="Boolean" default="false"/>

    <aura:handler name="init" value="{!this}" action="{!c.onInit}"/>
    <aura:handler name="change" value="{!v.carId}" action="{!c.onCarIdChange}"/>

    <force:recordData aura:id="carImages"
                      recordId="{!v.carId}"
                      mode="EDIT"
                      fields="Id, Name, ECS_VinNumber__c, ECS_ProductionYear__c, ECS_Model__c, ECS_ImageID__c"
                      targetFields="{!v.carTargetFields}"/>

    <aura:if isTrue="{!v.isAdmin}">
        <lightning:card title="{!$Label.c.ECS_Add_Image}">
            <div class="slds-form-element__row slds-grid_align-center">
                <lightning:fileUpload label="{!$Label.c.ECS_Add_Image}"
                                      multiple="true"
                                      accept=".jpg, .png"
                                      recordId="{!v.carId}"
                                      onuploadfinished="{!c.handleUploadFinished}"/>
            </div>
        </lightning:card>

        <aura:if isTrue="{!v.carImages.length != 0 }">
            <lightning:card class="slds-grid_align-center">
                <aura:iteration items="{!v.carImages}" var="imageId">
                    <lightning:layout class="customClass" multipleRows="true">
                        <lightning:layoutItem padding="around-small">
                            <div class="custom-box">
                                <div class="fileCardClass">
                                <lightning:fileCard fileId="{!imageId}"/></div>
                                <aura:if isTrue="{!imageId != v.carTargetFields.ECS_ImageID__c}">
                                    <aura:if isTrue="{!v.isAdmin}">
                                        <div class="buttons">
                                            <lightning:button name="{!$Label.c.ECS_Set_As_Main}"
                                                              onclick="{!c.setAsMainPicture}"
                                                              value="{!imageId}"
                                                              variant="neutral">
                                                <lightning:icon iconName="action:following" size="medium"/>
                                                &nbsp;{!$Label.c.ECS_Set_As_Main}
                                            </lightning:button>
                                        </div>
                                        <div class="buttons">
                                        <lightning:button name="{!$Label.c.ECS_Delete}" onclick="{!c.deleteImage}"
                                                          value="{!imageId}"
                                                          variant="neutral">
                                            <lightning:icon iconName="action:close" size="medium"/>
                                            &nbsp;{!$Label.c.ECS_Delete}
                                        </lightning:button>
                                        </div>
                                    </aura:if>
                                    <aura:set attribute="else">
                                        <div class="mainPhoto">
                                            <br/>
                                            <lightning:icon iconName="action:approval" size="medium"/>
                                            {!$Label.c.ECS_This_is_main_photo}
                                        </div>
                                    </aura:set>
                                </aura:if>
                            </div>
                        </lightning:layoutItem>
                    </lightning:layout>
                </aura:iteration>
            </lightning:card>

            <aura:set attribute="else">
                <lightning:card>
                    <lightning:formattedText value="{!$Label.c.ECS_No_Images_Found}"/>
                </lightning:card>
            </aura:set>
        </aura:if>
    </aura:if>
</aura:component>